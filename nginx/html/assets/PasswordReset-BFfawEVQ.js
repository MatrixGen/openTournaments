import{b5 as O,a as Q,r as n,aI as f,b7 as E,b8 as M,j as e,aT as X,L as _,aG as ee,b9 as te,B as T,l as L,b6 as D,aE as A,ba as I,aF as W}from"./index-Dd7dhgAO.js";function re(){const[j]=O(),N=Q(),[w,P]=n.useState(j.get("token")?"reset":"request"),[r,V]=n.useState("email"),[t,z]=n.useState({email:"",phone:"",token:j.get("token")||"",code:"",newPassword:"",confirmPassword:""}),[y,B]=n.useState({newPassword:!1,confirmPassword:!1}),[u,l]=n.useState(!1),[p,i]=n.useState(""),[S,c]=n.useState(""),[h,C]=n.useState(""),[d,Z]=n.useState(0),[m,v]=n.useState(0),x=n.useMemo(()=>"ontouchstart"in window||navigator.maxTouchPoints>0,[]);n.useEffect(()=>{if(m>0){const s=setTimeout(()=>v(m-1),1e3);return()=>clearTimeout(s)}},[m]);const $=n.useCallback(s=>{let a=0;return s.length>=8&&(a+=1),/[A-Z]/.test(s)&&(a+=1),/[a-z]/.test(s)&&(a+=1),/[0-9]/.test(s)&&(a+=1),/[^A-Za-z0-9]/.test(s)&&(a+=1),Math.min(5,a)},[]);n.useEffect(()=>{Z($(t.newPassword))},[t.newPassword,$]);const b=n.useCallback((s,a)=>{z(o=>({...o,[s]:a})),p&&i("")},[p]),R=n.useCallback(s=>{B(a=>({...a,[s]:!a[s]}))},[]),G=n.useCallback(async s=>{s.preventDefault(),l(!0),i(""),c("");const a=r==="email"?t.email.trim():t.phone.trim();if(!a){i(r==="email"?"Please enter your email address":"Please enter your phone number"),l(!1);return}try{r==="email"?(await f.requestPasswordResetEmail(a),C(t.email),c(`Password reset instructions have been sent to ${U(t.email)}`)):(await f.requestPasswordResetSMS(a),C(t.phone),c(`Password reset code has been sent to ${F(t.phone)}`)),v(60),P("reset")}catch(o){console.error("Password reset request error:",o);const g=o.response?.status;let k="Failed to request password reset. Please try again.";g===404?k=r==="email"?"No account found with this email address.":"No account found with this phone number.":g===429?k="Too many attempts. Please wait a few minutes before trying again.":o.response?.data?.message&&(k=o.response.data.message),i(k)}finally{l(!1)}},[r,t.email,t.phone]),Y=n.useCallback(async s=>{if(s.preventDefault(),l(!0),i(""),c(""),r==="email"&&!t.token.trim()){i("Please enter the verification token from your email."),l(!1);return}if(r==="sms"&&!t.code.trim()){i("Please enter the verification code from your SMS."),l(!1);return}if(t.newPassword.length<8){i("Password must be at least 8 characters long."),l(!1);return}if(t.newPassword!==t.confirmPassword){i("Passwords do not match. Please try again."),l(!1);return}try{r==="email"?await f.resetPasswordWithToken(t.token,t.newPassword):await f.resetPasswordWithCode(h,t.code,t.newPassword),c("Password reset successfully! Redirecting to login..."),setTimeout(()=>{N("/login",{state:{passwordResetSuccess:!0}})},3e3)}catch(a){console.error("Password reset error:",a);const o=a.response?.status;let g="Failed to reset password. Please try again.";o===400?g="Invalid or expired verification code. Please request a new one.":o===401?g="Invalid verification credentials. Please check and try again.":a.response?.data?.message&&(g=a.response.data.message),i(g)}finally{l(!1)}},[r,t,h,N]),H=n.useCallback(async()=>{if(!(m>0)){l(!0),i(""),c("");try{r==="email"?(await f.requestPasswordResetEmail(h),c("New verification email sent!")):(await f.requestPasswordResetSMS(h),c("New verification code sent!")),v(60)}catch{i("Failed to resend verification. Please try again.")}finally{l(!1)}}},[r,h,m]),U=n.useCallback(s=>{if(!s)return"";const[a,o]=s.split("@");return a.length<=2?s:`${a.substring(0,2)}***@${o}`},[]),F=n.useCallback(s=>s?`••••••${s.slice(-4)}`:"",[]),J=n.useMemo(()=>d<=1?"bg-red-500":d<=3?"bg-yellow-500":"bg-green-500",[d]),K=n.useMemo(()=>d<=1?"Very Weak":d<=2?"Weak":d<=3?"Good":d<=4?"Strong":"Very Strong",[d]),q=n.useMemo(()=>[{id:"email",label:"Email",icon:E,description:"Receive reset instructions via email"},{id:"sms",label:"SMS",icon:M,description:"Receive a verification code via SMS"}],[]);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white dark:from-neutral-900 dark:to-neutral-950 transition-colors",children:[e.jsx(X,{}),e.jsxs("main",{className:"mx-auto max-w-md py-6 sm:py-8 px-3 sm:px-4 lg:px-8",children:[e.jsxs(_,{to:"/login",className:"inline-flex items-center text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-300 mb-6 sm:mb-8 group",children:[e.jsx(ee,{className:"h-4 w-4 mr-2 group-hover:-translate-x-1 transition-transform"}),"Back to Login"]}),e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-primary-50 dark:bg-primary-900/20 rounded-full mb-4",children:e.jsx(te,{className:"h-8 w-8 text-primary-600 dark:text-primary-400"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-900 dark:text-white",children:w==="request"?"Reset Your Password":"Create New Password"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400 text-sm sm:text-base",children:w==="request"?"Choose how you want to reset your password":"Enter your new password to continue"})]}),p&&e.jsx(T,{type:"error",title:"Reset Failed",message:p,onClose:()=>i(""),className:"mb-6"}),S&&e.jsx(T,{type:"success",title:"Success!",message:S,className:"mb-6"}),e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-xl shadow-sm border border-gray-200 dark:border-neutral-700 p-4 sm:p-6",children:[w==="request"?e.jsxs("form",{onSubmit:G,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex border-b border-gray-200 dark:border-neutral-700",children:q.map(s=>{const a=s.icon,o=r===s.id;return e.jsxs("button",{type:"button",onClick:()=>V(s.id),className:`flex-1 flex flex-col items-center py-3 px-2 text-sm font-medium transition-colors ${o?"text-primary-600 dark:text-primary-400 border-b-2 border-primary-500":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(a,{className:`h-5 w-5 mb-1 ${o?"opacity-100":"opacity-70"}`}),e.jsx("span",{children:s.label})]},s.id)})}),e.jsx("p",{className:"mt-2 text-center text-xs text-gray-500 dark:text-gray-400",children:q.find(s=>s.id===r)?.description})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"contact",className:"block text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-2",children:r==="email"?"Email Address":"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:r==="email"?e.jsx(E,{className:"h-5 w-5 text-gray-400"}):e.jsx(M,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:r==="email"?"email":"tel",id:"contact",value:r==="email"?t.email:t.phone,onChange:s=>b(r==="email"?"email":"phone",s.target.value),className:`pl-10 w-full rounded-lg border bg-white dark:bg-neutral-700 py-3 px-4 text-gray-900 dark:text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 text-sm transition-colors ${x?"text-base":""} border-gray-300 dark:border-neutral-600 focus:border-primary-500 focus:ring-primary-500`,placeholder:r==="email"?"name@example.com":"+1 (555) 123-4567",required:!0})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:r==="email"?"We will send reset instructions to this email":"We will send a verification code to this number"})]}),e.jsx("button",{type:"submit",disabled:u,className:`w-full inline-flex items-center justify-center py-3 px-4 rounded-lg text-sm font-medium text-gray-900 dark:text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 transition-all ${x?"active:scale-98 min-h-12":""} ${u?"bg-gray-400 dark:bg-gray-600 cursor-not-allowed":"bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700"}`,children:u?e.jsxs(e.Fragment,{children:[e.jsx(L,{size:"sm",className:"mr-2"}),"Sending..."]}):"Send Reset Instructions"})]}):e.jsxs("form",{onSubmit:Y,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"verification",className:"block text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-2",children:r==="email"?"Verification Token":"Verification Code"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(D,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",id:"verification",value:r==="email"?t.token:t.code,onChange:s=>b(r==="email"?"token":"code",s.target.value),className:`pl-10 w-full rounded-lg border bg-white dark:bg-neutral-700 py-3 px-4 text-gray-900 dark:text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 text-sm transition-colors ${x?"text-base":""} border-gray-300 dark:border-neutral-600 focus:border-primary-500 focus:ring-primary-500`,placeholder:r==="email"?"Enter token from email":"Enter 6-digit code",required:!0,maxLength:r==="email"?void 0:6})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r==="email"?"Check your email for the reset token":`Sent to ${F(h)}`}),r==="sms"&&e.jsx("button",{type:"button",onClick:H,disabled:m>0||u,className:"text-xs font-medium text-primary-600 dark:text-primary-400 hover:text-primary-500 dark:hover:text-primary-300 disabled:text-gray-400 dark:disabled:text-gray-500",children:m>0?`Resend in ${m}s`:"Resend code"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(A,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:y.newPassword?"text":"password",id:"newPassword",value:t.newPassword,onChange:s=>b("newPassword",s.target.value),className:`pl-10 pr-10 w-full rounded-lg border bg-white dark:bg-neutral-700 py-3 px-4 text-gray-900 dark:text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 text-sm transition-colors ${x?"text-base":""} border-gray-300 dark:border-neutral-600 focus:border-primary-500 focus:ring-primary-500`,placeholder:"Enter new password",required:!0,minLength:"8"}),e.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-3 flex items-center ${x?"p-3":""} text-gray-400 hover:text-gray-600 dark:hover:text-gray-300`,onClick:()=>R("newPassword"),children:y.newPassword?e.jsx(I,{className:"h-5 w-5"}):e.jsx(W,{className:"h-5 w-5"})})]}),t.newPassword&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:"Password Strength"}),e.jsx("span",{className:`font-medium ${d<=1?"text-red-600 dark:text-red-400":d<=3?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400"}`,children:K})]}),e.jsx("div",{className:"h-1.5 bg-gray-200 dark:bg-neutral-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${J} transition-all duration-300`,style:{width:`${d/5*100}%`}})}),e.jsxs("ul",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400 space-y-0.5",children:[e.jsxs("li",{className:`flex items-center ${t.newPassword.length>=8?"text-green-600 dark:text-green-400":""}`,children:[e.jsx("span",{className:"mr-1",children:"•"}),"At least 8 characters"]}),e.jsxs("li",{className:`flex items-center ${/[A-Z]/.test(t.newPassword)?"text-green-600 dark:text-green-400":""}`,children:[e.jsx("span",{className:"mr-1",children:"•"}),"Contains uppercase letter"]}),e.jsxs("li",{className:`flex items-center ${/[0-9]/.test(t.newPassword)?"text-green-600 dark:text-green-400":""}`,children:[e.jsx("span",{className:"mr-1",children:"•"}),"Contains number"]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(A,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:y.confirmPassword?"text":"password",id:"confirmPassword",value:t.confirmPassword,onChange:s=>b("confirmPassword",s.target.value),className:`pl-10 pr-10 w-full rounded-lg border bg-white dark:bg-neutral-700 py-3 px-4 text-gray-900 dark:text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 text-sm transition-colors ${x?"text-base":""} border-gray-300 dark:border-neutral-600 focus:border-primary-500 focus:ring-primary-500`,placeholder:"Confirm new password",required:!0,minLength:"8"}),e.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-3 flex items-center ${x?"p-3":""} text-gray-400 hover:text-gray-600 dark:hover:text-gray-300`,onClick:()=>R("confirmPassword"),children:y.confirmPassword?e.jsx(I,{className:"h-5 w-5"}):e.jsx(W,{className:"h-5 w-5"})})]}),t.confirmPassword&&t.newPassword!==t.confirmPassword&&e.jsx("p",{className:"mt-1 text-xs text-red-600 dark:text-red-400",children:"Passwords do not match"})]}),e.jsx("button",{type:"submit",disabled:u||t.newPassword!==t.confirmPassword||t.newPassword.length<8,className:`w-full inline-flex items-center justify-center py-3 px-4 rounded-lg text-sm font-medium text-gray-900 dark:text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-primary-500 transition-all ${x?"active:scale-98 min-h-12":""} ${u||t.newPassword!==t.confirmPassword||t.newPassword.length<8?"bg-gray-400 dark:bg-gray-600 cursor-not-allowed":"bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700"}`,children:u?e.jsxs(e.Fragment,{children:[e.jsx(L,{size:"sm",className:"mr-2"}),"Resetting..."]}):"Reset Password"})]}),w==="reset"&&e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-neutral-700",children:e.jsxs("button",{type:"button",onClick:()=>P("request"),className:"text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-300 w-full text-center",children:["← Use different ",r==="email"?"email":"phone number"]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-neutral-800/50 px-4 py-2 rounded-full",children:[e.jsx(D,{className:"h-3 w-3"}),e.jsx("span",{children:"Your password reset is encrypted and secure"})]})})]})]})}export{re as default};
