import{j as e,aS as T,f as n,r as i,bc as I,u as ke,aQ as je,bd as Ne,bt as ve,aR as We,bg as Se,B as L,ay as Me,bq as P,aU as K,aV as A,aX as O,ax as E,bn as G,b8 as X,aD as _e,aB as V,be as Ce}from"./index-Dd7dhgAO.js";import{p,F as Fe}from"./payoutService-fzfCuFgw.js";import{a as J}from"./formatters-DuOnlAX0.js";import{F as Pe,a as $e}from"./UserCircleIcon-B5TCXpP0.js";import{F as ee}from"./CurrencyDollarIcon-DqON1HzM.js";import{F as N}from"./ArrowPathIcon-BDzFR-8G.js";import{F as te}from"./BuildingLibraryIcon-YRwM0-pi.js";import{F as Re}from"./CheckIcon-FxAnfe32.js";import{F as H}from"./ClockIcon-DpHVzJ4M.js";const Be=({previewResult:s,onConfirm:c,onCancelPreview:m,isConfirming:l})=>{if(!s)return null;const{fee_tzs:g,net_amount_tzs:u,amount:w,recipient:x,channel_provider:h,exchange_info:r}=s;return e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-xl p-4 md:p-6 mb-6 border border-gray-200 dark:border-neutral-700 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-3",children:[e.jsx("div",{className:"p-1.5 md:p-2 bg-blue-500/20 rounded-lg",children:e.jsx(T,{className:"h-4 w-4 md:h-6 md:w-6 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm md:text-lg font-semibold text-gray-900 dark:text-gray-900 dark:text-white",children:"Withdrawal Preview"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600 dark:text-gray-400",children:"Review details before confirming"})]})]}),e.jsx("button",{onClick:m,className:"text-xs md:text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:"Change"})]}),e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-neutral-700/50 rounded-lg p-4 md:p-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 md:gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Withdrawal Amount"}),e.jsx("p",{className:"text-xl md:text-2xl font-bold text-gray-900 dark:text-gray-900 dark:text-white",children:n(w||0)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Transaction Fee"}),e.jsxs("p",{className:"text-lg md:text-xl font-bold text-red-600 dark:text-red-500",children:["- ",n(g||0)]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-neutral-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-base md:text-lg font-medium text-gray-900 dark:text-gray-900 dark:text-white",children:"You Will Receive"}),e.jsx("p",{className:"text-2xl md:text-3xl font-bold text-green-600 dark:text-green-500",children:n(u||0)})]})})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-neutral-700/50 rounded-lg p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-3 mb-3 md:mb-4",children:[e.jsx(Pe,{className:"h-4 w-4 md:h-5 md:w-5 text-primary-500 dark:text-primary-400"}),e.jsx("h4",{className:"text-sm md:text-base font-medium text-gray-900 dark:text-gray-900 dark:text-white",children:"Recipient Details"})]}),x?.phone_number&&e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Phone Number"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white",children:J(x.phone_number)})]}),x?.account_number&&e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Account Number"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white",children:x.account_number})]}),x?.account_name&&e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Account Name"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white",children:x.account_name})]}),h&&e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Provider"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white",children:h})]})]}),r&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-3 mb-3",children:[e.jsx(ee,{className:"h-4 w-4 md:h-5 md:w-5 text-blue-500"}),e.jsx("h4",{className:"text-sm md:text-base font-medium text-gray-900 dark:text-gray-900 dark:text-white",children:"Currency Exchange"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 md:gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"From"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white",children:[r.sourceCurrency," ",n(r.sourceAmount)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"To"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white",children:[r.targetCurrency," ",n(r.rate*r.sourceAmount)]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["Rate: 1 ",r.sourceCurrency," = ",r.rate," ",r.targetCurrency]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("button",{onClick:c,disabled:l,className:"flex-1 inline-flex justify-center items-center rounded-lg md:rounded-xl bg-gradient-to-r from-green-500 to-emerald-600 py-4 md:py-5 px-6 text-lg md:text-xl font-semibold text-gray-900 dark:text-white shadow-lg hover:from-green-600 hover:to-emerald-700 focus:outline-none focus:ring-4 focus:ring-green-500/30 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:l?e.jsxs("span",{className:"flex items-center space-x-2 md:space-x-3",children:[e.jsx(N,{className:"h-5 w-5 md:h-6 md:w-6 animate-spin"}),e.jsx("span",{children:"Processing..."})]}):`Confirm Withdrawal of ${n(u||0),"TZS"}`}),e.jsx("button",{onClick:m,className:"px-4 md:px-6 py-3 md:py-4 border border-gray-300 dark:border-neutral-600 text-gray-700 dark:text-gray-300 rounded-lg md:rounded-xl text-sm md:text-base font-medium hover:bg-gray-50 dark:hover:bg-neutral-700 transition-colors",children:"Cancel"})]})]})]})},o=Ne();Ce();const d=ve(),Ae=()=>K({amount:O().min(d.minMobileMoneyWithdrawal,`Minimum withdrawal is ${n(d.minMobileMoneyWithdrawal)}`).max(d.maxMobileMoneyWithdrawal,`Maximum withdrawal is ${n(d.maxMobileMoneyWithdrawal)}`).refine(s=>s%d.withdrawalStep===0,{message:`Amount must be in multiples of ${n(d.withdrawalStep)}`}),...I()?{phoneNumber:A().min(9,"Phone number must be at least 9 digits").max(12,"Phone number is too long").regex(/^[0-9]+$/,"Phone number must contain only digits").transform(s=>{if(o.code==="TZS"){if(!s.startsWith("255"))return s.startsWith("0")?`255${s.slice(1)}`:`255${s}`}else if(o.code==="KES"&&!s.startsWith("254"))return s.startsWith("0")?`254${s.slice(1)}`:`254${s}`;return s})}:{}}),Te=()=>K({amount:O().min(d.minBankWithdrawal,`Minimum bank withdrawal is ${n(d.minBankWithdrawal)}`).max(d.maxBankWithdrawal,`Maximum withdrawal is ${n(d.maxBankWithdrawal)}`).refine(s=>s%d.withdrawalStep===0,{message:`Amount must be in multiples of ${n(d.withdrawalStep)}`}),accountNumber:A().min(5,"Account number must be at least 5 digits").max(20,"Account number is too long"),accountName:A().min(2,"Account name must be at least 2 characters").max(100,"Account name is too long"),...o.code==="USD"?{bic:A().optional().refine(s=>!s||s.length>=8,{message:"BIC must be at least 8 characters if provided"})}:{}}),Ie=({status:s})=>{const c={previewed:{color:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300",text:"Previewed",icon:T},initiated:{color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300",text:"Initiated",icon:H},authorized:{color:"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-300",text:"Authorized",icon:V},processing:{color:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300",text:"Processing",icon:N},pending:{color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300",text:"Pending",icon:H},successful:{color:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300",text:"Successful",icon:V},failed:{color:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300",text:"Failed",icon:E},cancelled:{color:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300",text:"Cancelled",icon:E},reversed:{color:"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300",text:"Reversed",icon:N},refunded:{color:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300",text:"Refunded",icon:N}},m=c[s]||c.pending,l=m.icon;return e.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 md:px-3 md:py-1 rounded-full text-xs md:text-sm font-medium ${m.color}`,children:[e.jsx(l,{className:"h-3 w-3 md:h-4 md:w-4 mr-1"}),m.text]})},Ee=({status:s,orderReference:c,withdrawalMethod:m,recipientDetails:l,onCancel:g,onReconcile:u,isCancelling:w,isReconciling:x,user:h})=>{if(!s)return null;const r=()=>{switch(s){case"successful":return e.jsx(V,{className:"h-6 w-6 md:h-8 md:w-8 text-green-500"});case"failed":case"cancelled":return e.jsx(E,{className:"h-6 w-6 md:h-8 md:w-8 text-red-500"});case"reversed":case"refunded":return e.jsx(N,{className:"h-6 w-6 md:h-8 md:w-8 text-blue-500"});default:return e.jsx(H,{className:"h-6 w-6 md:h-8 md:w-8 text-yellow-500 animate-pulse"})}},$=()=>{switch(s){case"successful":return"Withdrawal completed successfully!";case"failed":return"Withdrawal failed. Please try again.";case"cancelled":return"Withdrawal was cancelled.";case"reversed":return"Withdrawal was reversed.";case"refunded":return"Withdrawal was refunded.";case"processing":return"Withdrawal is being processed.";case"pending":case"initiated":return"Withdrawal initiated. Processing...";case"authorized":return"Withdrawal authorized. Processing...";default:return"Withdrawal in progress..."}},f=["previewed","pending","processing","initiated","authorized"].includes(s),k=()=>{switch(m){case"mobile_money_payout":return"Mobile Money";case"bank_payout":return"Bank Transfer";default:return"Withdrawal"}},W=m==="mobile_money_payout"?e.jsx(X,{className:"h-4 w-4 text-blue-500"}):e.jsx(te,{className:"h-4 w-4 text-green-500"});return e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-xl p-4 md:p-6 mb-6 border border-gray-200 dark:border-neutral-700 shadow-lg",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3 md:space-x-4 flex-1 min-w-0",children:[e.jsx("div",{className:"p-1.5 md:p-2 bg-gray-100 dark:bg-neutral-700 rounded-lg flex-shrink-0",children:r()}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:"text-xs md:text-sm text-gray-500 dark:text-gray-400",children:k()}),e.jsx(Ie,{status:s})]}),e.jsx("h3",{className:"text-base md:text-lg font-semibold text-gray-900 dark:text-gray-900 dark:text-white truncate",children:"Withdrawal Status"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600 dark:text-gray-300 truncate",children:$()})]})]})}),c&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-neutral-700",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-neutral-700/30 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Reference"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-900 dark:text-gray-900 dark:text-white font-mono truncate mt-1",children:c})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-neutral-700/30 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Method"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[W,e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-900 dark:text-white font-medium",children:k()})]})]}),h&&e.jsxs("div",{className:"bg-gray-50 dark:bg-neutral-700/30 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Current Balance"}),e.jsx("p",{className:"text-xl md:text-2xl font-bold text-green-600 dark:text-green-500 mt-1",children:n(h.wallet_balance||0,"USD")})]})]}),l&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4",children:[l.phone_number&&e.jsxs("div",{className:"bg-gray-50 dark:bg-neutral-700/30 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Phone Number"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-900 dark:text-white mt-1",children:J(l.phone_number)})]}),l.account_number&&e.jsxs("div",{className:"bg-gray-50 dark:bg-neutral-700/30 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Account Number"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-900 dark:text-white font-mono truncate mt-1",children:l.account_number})]}),l.account_name&&e.jsxs("div",{className:"bg-gray-50 dark:bg-neutral-700/30 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Account Name"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-900 dark:text-white font-medium truncate mt-1",children:l.account_name})]}),l.bic&&e.jsxs("div",{className:"bg-gray-50 dark:bg-neutral-700/30 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"BIC Code"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-900 dark:text-white font-mono truncate mt-1",children:l.bic})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[f&&e.jsxs("button",{onClick:()=>g(c),disabled:w,className:"flex-1 min-w-[140px] inline-flex items-center justify-center px-3 py-2 border border-red-600 text-red-600 dark:text-red-500 dark:border-red-500 rounded-lg text-sm font-medium hover:bg-red-600 dark:hover:bg-red-600 hover:text-gray-900 dark:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[w?e.jsx(N,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(E,{className:"h-4 w-4 mr-1"}),w?"Cancelling...":"Cancel"]}),e.jsxs("button",{onClick:()=>u(c),disabled:x,className:"flex-1 min-w-[140px] inline-flex items-center justify-center px-3 py-2 border border-blue-600 text-blue-600 dark:text-blue-500 dark:border-blue-500 rounded-lg text-sm font-medium hover:bg-blue-600 dark:hover:bg-blue-600 hover:text-gray-900 dark:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[x?e.jsx(N,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(N,{className:"h-4 w-4 mr-1"}),x?"Checking...":"Check Status"]})]})]})]})},Ue=({amounts:s,selectedAmount:c,onSelect:m,minAmount:l})=>{const[g,u]=i.useState(0),w=()=>{u(r=>Math.max(r-1,0))},x=()=>{u(r=>Math.min(r+1,s.length-3))},h=s.filter(r=>r>=l);return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"hidden md:grid md:grid-cols-3 lg:grid-cols-6 gap-2 md:gap-3",children:h.map(r=>e.jsx("button",{type:"button",onClick:()=>m(r),className:`py-2 md:py-3 px-3 md:px-4 text-sm md:text-base font-medium rounded-lg transition-all ${c===r?"bg-primary-500 text-gray-900 dark:text-white shadow-lg":"bg-gray-100 dark:bg-neutral-700 hover:bg-gray-200 dark:hover:bg-neutral-600 text-gray-900 dark:text-gray-900 dark:text-white"}`,children:n(r)},r))}),e.jsx("div",{className:"md:hidden",children:h.length>0?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:w,disabled:g===0,className:"p-2 text-gray-500 disabled:opacity-30",children:e.jsx($e,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"flex transition-transform duration-300",style:{transform:`translateX(-${g*(100/3)}%)`},children:h.map(r=>e.jsx("div",{className:"w-1/3 flex-shrink-0 px-1",children:e.jsx("button",{type:"button",onClick:()=>m(r),className:`w-full py-2 text-sm font-medium rounded-lg transition-all ${c===r?"bg-primary-500 text-gray-900 dark:text-white shadow-lg":"bg-gray-100 dark:bg-neutral-700 hover:bg-gray-200 dark:hover:bg-neutral-600 text-gray-900 dark:text-gray-900 dark:text-white"}`,children:n(r)})},r))})}),e.jsx("button",{onClick:x,disabled:g>=h.length-3,className:"p-2 text-gray-500 disabled:opacity-30",children:e.jsx(_e,{className:"h-5 w-5"})})]}):e.jsx("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400",children:"No quick amounts available for this method"})})]})},De=({selectedMethod:s,onSelectMethod:c})=>{const m=[...I()?[{id:"mobile_money",name:"Mobile Money",description:`Withdraw to your mobile money account (${P("mobileMoney")})`,icon:X,color:"from-blue-500 to-blue-600",minAmount:d.minMobileMoneyWithdrawal,maxAmount:d.maxMobileMoneyWithdrawal,fee:G("mobileMoney")}]:[],{id:"bank_transfer",name:"Bank Transfer",description:`Withdraw to your bank account (${P("bankTransfer")})`,icon:te,color:"from-green-500 to-green-600",minAmount:d.minBankWithdrawal,maxAmount:d.maxBankWithdrawal,fee:G("bankTransfer")}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6 md:mb-8",children:m.map(l=>{const g=l.icon,u=s===l.id;return e.jsxs("button",{type:"button",onClick:()=>c(l.id),className:`relative p-4 md:p-6 rounded-xl md:rounded-2xl border-2 transition-all duration-300 text-left overflow-hidden group ${u?"border-primary-500 bg-primary-50 dark:bg-primary-900/20 shadow-lg":"border-gray-200 dark:border-neutral-700 hover:border-gray-300 dark:hover:border-neutral-600 bg-white dark:bg-neutral-800"}`,children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${l.color} opacity-0 group-hover:opacity-5 transition-opacity duration-300`}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 md:mb-4",children:[e.jsx("div",{className:`p-2 md:p-3 rounded-lg md:rounded-xl bg-gradient-to-br ${l.color} bg-opacity-10`,children:e.jsx(g,{className:"h-5 w-5 md:h-6 md:w-6 text-gray-900 dark:text-gray-900 dark:text-white"})}),u&&e.jsx(Re,{className:"h-5 w-5 md:h-6 md:w-6 text-primary-500 dark:text-primary-400"})]}),e.jsx("h3",{className:"text-base md:text-xl font-semibold text-gray-900 dark:text-gray-900 dark:text-white mb-2",children:l.name}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600 dark:text-gray-400 mb-3",children:l.description}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs md:text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Minimum:"}),e.jsx("span",{className:"text-green-600 dark:text-green-400 font-medium",children:n(l.minAmount)})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs md:text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Maximum:"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-900 dark:text-white font-medium",children:n(l.maxAmount)})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs md:text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Fee:"}),e.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:n(l.fee)})]})]})]})]},l.id)})})};function Ke(){const[s,c]=i.useState(!1),[m,l]=i.useState(!1),[g,u]=i.useState(!1),[w,x]=i.useState(!1),[h,r]=i.useState(""),[$,f]=i.useState(""),[k,W]=i.useState(null),[S,R]=i.useState(null),[v,ae]=i.useState(null),[j,re]=i.useState(null),[b,se]=i.useState(I()?"mobile_money":"bank_transfer"),[M,_]=i.useState(null),[de,B]=i.useState(null),[le,Z]=i.useState(null),{user:U,updateUser:q}=ke(),ne=b==="mobile_money"?Ae():Te(),{register:C,handleSubmit:ie,formState:{errors:y,isValid:ce},setValue:Q,watch:me,trigger:oe,getValues:xe,reset:D}=je({resolver:We(ne),mode:"onChange",defaultValues:{amount:I()?d.minMobileMoneyWithdrawal:d.minBankWithdrawal,phoneNumber:"",accountNumber:"",accountName:"",...o.code==="USD"?{bic:""}:{}}}),ue=me("amount");i.useEffect(()=>{if(k&&S?.status!=="successful"){const t=setInterval(()=>{Y(k)},15e3);return re(t),()=>{t&&clearInterval(t)}}},[k,S]),i.useEffect(()=>()=>{j&&clearInterval(j)},[j]);const z=async()=>{try{const t=await p.getWithdrawalStats();t.success&&ae(t.data)}catch(t){console.error("Failed to load withdrawal stats:",t)}},he=t=>{se(t),_(null),r(""),D({amount:t==="bank_transfer"?d.minBankWithdrawal:d.minMobileMoneyWithdrawal,phoneNumber:"",accountNumber:"",accountName:"",...o.code==="USD"?{bic:""}:{}})},ge=async t=>{c(!0),r("");try{let a;if(b==="mobile_money"?(a=await p.previewMobileMoneyPayout(t.amount,t.phoneNumber,o.code),B({phone_number:t.phoneNumber}),Z("mobile_money_payout")):(a=await p.previewBankPayout(t.amount,t.accountNumber,t.accountName,t.bic,o.code),B({account_number:t.accountNumber,account_name:t.accountName,bic:t.bic}),Z("bank_payout")),!a.success)throw new Error(a.error||"Preview failed");_(a.data),f("Preview generated successfully. Review details below.")}catch(a){console.error("Preview error:",a),r(a.message||"Failed to generate withdrawal preview. Please try again.")}finally{c(!1)}},be=async()=>{x(!0),r("");try{let t;const a=xe();if(b==="mobile_money"?t=await p.createMobileMoneyPayout(a.amount,a.phoneNumber,M.order_reference,o.code):t=await p.createBankPayout(a.amount,a.accountNumber,a.accountName,a.bic,M.order_reference,o.code),!t.success)throw new Error(t.error||"Withdrawal creation failed");W(t.data.order_reference),R({status:t.data.status,amount:a.amount,...de}),_(null),f(`Withdrawal initiated successfully! ${b==="mobile_money"?"You will receive funds within 24 hours.":"You will receive funds within 1-3 business days."}`),z();const F=await p.getWalletBalance();F.success&&q({wallet_balance:F.data.balance})}catch(t){console.error("Withdrawal creation error:",t),r(t.message||"Failed to process withdrawal. Please try again.")}finally{x(!1)}},ye=()=>{_(null),B(null),r(""),f("")},Y=async t=>{try{const a=await p.getPayoutStatus(t);if(!a.success)throw new Error(a.error||"Failed to check withdrawal status");if(R(a.data),a.data.status==="successful"){j&&clearInterval(j),f("Withdrawal successful! Funds have been sent.");const F=await p.getWalletBalance();F.success&&q({wallet_balance:F.data.balance}),z(),setTimeout(()=>{D(),W(null),R(null),_(null),B(null)},5e3)}else["failed","cancelled","reversed","refunded"].includes(a.data.status)&&(j&&clearInterval(j),r(`Withdrawal ${a.data.status}.`))}catch(a){console.error("Status check error:",a)}},pe=async t=>{u(!0);try{const a=await p.reconcilePayoutStatus(t);a.success?(a.reconciled?f("Withdrawal status updated successfully."):f("Withdrawal status is already up to date."),await Y(t)):r(a.error||"Failed to reconcile withdrawal status")}catch(a){r(a.message||"Failed to reconcile withdrawal")}finally{u(!1)}},we=async t=>{l(!0);try{const a=await p.cancelPendingWithdrawal(t);if(!a.success)throw new Error(a.error||"Failed to cancel withdrawal");f("Withdrawal cancelled successfully."),j&&clearInterval(j),W(null),R(null),D()}catch(a){r(a.message||"Failed to cancel withdrawal")}finally{l(!1)}},fe=Se().concat([d.maxMobileMoneyWithdrawal*.25,d.maxMobileMoneyWithdrawal*.5,d.maxMobileMoneyWithdrawal*.75]).sort((t,a)=>t-a);return i.useEffect(()=>{z()},[]),e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gradient-to-b dark:from-neutral-900 dark:to-neutral-800 safe-padding",children:e.jsxs("main",{className:"mx-auto max-w-6xl py-4 md:py-8 px-3 sm:px-4 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[e.jsx(ee,{className:"h-6 w-6 md:h-8 md:w-8 text-primary-500"}),e.jsx("h1",{className:"text-2xl md:text-4xl font-bold text-gray-900 dark:text-gray-900 dark:text-white",children:"Withdraw Funds"})]}),e.jsx("div",{className:"flex items-center justify-center mb-3",children:e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full bg-primary-100 dark:bg-primary-900/30 text-primary-800 dark:text-primary-300 text-sm font-medium",children:[o.code," - ",o.name]})}),e.jsx("p",{className:"text-sm md:text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto px-4",children:"Transfer funds from your wallet to your account."})]}),e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"hidden lg:block lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-neutral-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-900 dark:text-white",children:"Wallet Balance"}),e.jsx("div",{className:"bg-primary-500/20 p-2 rounded-lg",children:e.jsx("span",{className:"text-primary-600 dark:text-primary-400 text-sm font-medium",children:o.code})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-5xl font-bold text-gray-900 dark:text-gray-900 dark:text-white mb-2",children:n(U?.wallet_balance||0)}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Available for withdrawal"})]}),v&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-neutral-700/50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Total Withdrawals"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-900 dark:text-white font-medium",children:n(v.total_withdrawals||0,"USD")})]})}),e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-neutral-700/50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"This Month"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-900 dark:text-white font-medium",children:n(v.this_month_withdrawals||0,"USD")})]})}),e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-neutral-700/50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Total Fees Paid"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-900 dark:text-white font-medium",children:n(v.total_fees_paid||0,"USD")})]})}),v.pending_withdrawals>0&&e.jsx("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-yellow-600 dark:text-yellow-400 text-sm",children:"Pending Withdrawals"}),e.jsx("span",{className:"text-yellow-600 dark:text-yellow-400 font-medium",children:n(v.pending_withdrawals||0,"USD")})]})})]})]}),e.jsx("div",{className:"bg-white dark:bg-neutral-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-neutral-700",children:e.jsx("button",{onClick:()=>window.location.href="/wallet/transactions?type=withdrawal",className:"mt-4 w-full text-center text-primary-600 dark:text-primary-500 hover:text-primary-700 dark:hover:text-primary-400 text-sm font-medium py-2",children:"View Withdrawal History →"})})]}),e.jsxs("div",{className:"lg:col-span-3",children:[e.jsx("div",{className:"lg:hidden bg-white dark:bg-neutral-800 rounded-xl p-4 mb-6 shadow border border-gray-200 dark:border-neutral-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Current Balance"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-900 dark:text-white",children:n(U?.wallet_balance||0,"USD")})]}),e.jsx("button",{onClick:()=>window.location.href="/wallet/transactions?type=withdrawal",className:"text-sm text-primary-600 dark:text-primary-500",children:"History →"})]})}),h&&e.jsx(L,{type:"error",title:"Error",message:h,onClose:()=>r(""),className:"mb-6"}),$&&e.jsx(L,{type:"success",title:"Success",message:$,className:"mb-6"}),S&&k&&e.jsx(Ee,{status:S.status,orderReference:k,withdrawalMethod:le,recipientDetails:S,onCancel:we,onReconcile:pe,isCancelling:m,isReconciling:g,user:U}),M&&e.jsx(Be,{previewResult:M,withdrawalMethod:b,onConfirm:be,onCancelPreview:ye,isConfirming:w}),!M&&!k&&e.jsxs("div",{className:"bg-white dark:bg-neutral-800 rounded-xl shadow-lg p-4 md:p-8 border border-gray-200 dark:border-neutral-700",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-base md:text-xl font-semibold text-gray-900 dark:text-gray-900 dark:text-white mb-4",children:"Select Withdrawal Method"}),e.jsx(De,{selectedMethod:b,onSelectMethod:he})]}),e.jsxs("form",{onSubmit:ie(ge),className:"space-y-6 md:space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-base md:text-lg font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-3",children:"How much would you like to withdraw?"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 md:pl-4 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-base md:text-xl",children:o.symbol})}),e.jsx("input",{type:"number",id:"amount",step:d.withdrawalStep,min:b==="bank_transfer"?d.minBankWithdrawal:d.minMobileMoneyWithdrawal,max:d.maxBankWithdrawal,...C("amount",{valueAsNumber:!0}),className:"block w-full pl-14 md:pl-16 text-lg md:text-xl rounded-lg md:rounded-xl border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-700 py-3 md:py-4 px-4 text-gray-900 dark:text-gray-900 dark:text-white placeholder-gray-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-all",placeholder:b==="bank_transfer"?d.minBankWithdrawal.toString():d.minMobileMoneyWithdrawal.toString()})]}),y.amount&&e.jsx("p",{className:"mt-2 text-sm text-red-500 dark:text-red-400",children:y.amount.message}),e.jsx("p",{className:"mt-2 text-xs md:text-sm text-gray-500 dark:text-gray-400",children:b==="bank_transfer"?`Minimum: ${n(d.minBankWithdrawal)} | Maximum: ${n(d.maxBankWithdrawal)}`:`Minimum: ${n(d.minMobileMoneyWithdrawal)} | Maximum: ${n(d.maxMobileMoneyWithdrawal)}`})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-neutral-700/50 p-4 rounded-lg md:rounded-xl",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-3",children:"Quick Amounts"}),e.jsx(Ue,{amounts:fe,selectedAmount:ue,minAmount:b==="bank_transfer"?d.minBankWithdrawal:d.minMobileMoneyWithdrawal,onSelect:t=>{Q("amount",t,{shouldValidate:!0}),oe("amount")}})]}),b==="mobile_money"?e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phoneNumber",className:"block text-base md:text-lg font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-3",children:"Mobile Money Phone Number"}),e.jsxs("div",{className:"flex rounded-lg md:rounded-xl shadow-sm",children:[e.jsx("span",{className:"inline-flex items-center rounded-l-lg md:rounded-l-xl border border-r-0 border-gray-300 dark:border-neutral-600 bg-gray-50 dark:bg-neutral-700 px-3 md:px-4 text-gray-600 dark:text-gray-300 text-base md:text-lg",children:o.code==="TZS"?"+255":o.code==="KES"?"+254":"+"}),e.jsx("input",{type:"tel",id:"phoneNumber",...C("phoneNumber"),onChange:t=>{const a=t.target.value.replace(/[^0-9]/g,"").slice(0,9);Q("phoneNumber",a,{shouldValidate:!0})},placeholder:"712345678",className:"block w-full rounded-r-lg md:rounded-r-xl border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-700 py-3 md:py-4 px-4 text-gray-900 dark:text-gray-900 dark:text-white placeholder-gray-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-all"})]}),y.phoneNumber&&e.jsx("p",{className:"mt-2 text-sm text-red-500 dark:text-red-400",children:y.phoneNumber.message}),e.jsx("p",{className:"mt-2 text-xs md:text-sm text-gray-500 dark:text-gray-400",children:"Enter your phone number without country code (e.g., 712345678)"})]}):e.jsxs("div",{className:"space-y-6 md:space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"accountNumber",className:"block text-base md:text-lg font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-3",children:"Bank Account Number"}),e.jsx("input",{type:"text",id:"accountNumber",...C("accountNumber"),className:"block w-full text-lg md:text-xl rounded-lg md:rounded-xl border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-700 py-3 md:py-4 px-4 text-gray-900 dark:text-gray-900 dark:text-white placeholder-gray-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-all",placeholder:"1234567890"}),y.accountNumber&&e.jsx("p",{className:"mt-2 text-sm text-red-500 dark:text-red-400",children:y.accountNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"accountName",className:"block text-base md:text-lg font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-3",children:"Account Holder Name"}),e.jsx("input",{type:"text",id:"accountName",...C("accountName"),className:"block w-full text-lg md:text-xl rounded-lg md:rounded-xl border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-700 py-3 md:py-4 px-4 text-gray-900 dark:text-gray-900 dark:text-white placeholder-gray-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-all",placeholder:"John Doe"}),y.accountName&&e.jsx("p",{className:"mt-2 text-sm text-red-500 dark:text-red-400",children:y.accountName.message}),e.jsx("p",{className:"mt-2 text-xs md:text-sm text-gray-500 dark:text-gray-400",children:"Must match the name on your bank account exactly"})]}),o.code==="USD"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bic",className:"block text-base md:text-lg font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-3",children:"BIC/SWIFT Code (Optional)"}),e.jsx("input",{type:"text",id:"bic",...C("bic"),className:"block w-full text-lg md:text-xl rounded-lg md:rounded-xl border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-700 py-3 md:py-4 px-4 text-gray-900 dark:text-gray-900 dark:text-white placeholder-gray-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-all",placeholder:"NMBTZTZT"}),y.bic&&e.jsx("p",{className:"mt-2 text-sm text-red-500 dark:text-red-400",children:y.bic.message}),e.jsx("p",{className:"mt-2 text-xs md:text-sm text-gray-500 dark:text-gray-400",children:"Required for international bank transfers"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"submit",disabled:s||!ce,className:"w-full md:w-auto inline-flex items-center justify-center px-6 md:px-8 py-3 md:py-4 bg-gradient-to-r from-primary-500 to-primary-600 text-gray-900 dark:text-white rounded-lg md:rounded-xl text-base md:text-lg font-semibold hover:from-primary-600 hover:to-primary-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:s?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4 md:h-5 md:w-5 animate-spin mr-2"}),"Generating Preview..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"h-4 w-4 md:h-5 md:w-5 mr-2"}),"Preview Withdrawal"]})})})]}),e.jsx("div",{className:"mt-6 md:mt-8 pt-6 md:pt-8 border-t border-gray-200 dark:border-neutral-700",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs md:text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-2 md:mb-3",children:[e.jsx(T,{className:"h-4 w-4 md:h-5 md:w-5 inline mr-1 md:mr-2 text-primary-500 dark:text-primary-400"}),"How it works:"]}),e.jsxs("ol",{className:"text-xs md:text-sm text-gray-600 dark:text-gray-400 space-y-1 md:space-y-2 pl-2",children:[e.jsx("li",{children:"1. Select withdrawal method"}),e.jsx("li",{children:"2. Enter amount and details"}),e.jsx("li",{children:"3. Preview withdrawal (see fees)"}),e.jsx("li",{children:"4. Confirm withdrawal"}),e.jsx("li",{children:"5. Track status in real-time"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs md:text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-2 md:mb-3",children:[e.jsx(Me,{className:"h-4 w-4 md:h-5 md:w-5 inline mr-1 md:mr-2 text-yellow-500"}),"Important:"]}),e.jsxs("ul",{className:"text-xs md:text-sm text-gray-600 dark:text-gray-400 space-y-1 md:space-y-2",children:[e.jsxs("li",{children:["• Mobile Money: ",P("mobileMoney")]}),e.jsxs("li",{children:["• Bank Transfer: ",P("bankTransfer")]}),e.jsx("li",{children:"• Transaction fees apply"}),e.jsx("li",{children:"• Daily limits may apply"})]})]})]})})]}),e.jsxs("div",{className:"mt-6 md:mt-8 bg-white dark:bg-neutral-800 rounded-xl p-4 md:p-6 border border-gray-200 dark:border-neutral-700",children:[e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-3 mb-3 md:mb-4",children:[e.jsx(T,{className:"h-5 w-5 md:h-6 md:w-6 text-primary-500"}),e.jsx("h3",{className:"text-base md:text-lg font-semibold text-gray-900 dark:text-gray-900 dark:text-white",children:"Need Help?"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-neutral-700/50 rounded-lg",children:[e.jsx("h4",{className:"text-xs md:text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-1 md:mb-2",children:"Withdrawal Issues"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600 dark:text-gray-400",children:'Use "Check Status" to update withdrawal status.'})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-neutral-700/50 rounded-lg",children:[e.jsx("h4",{className:"text-xs md:text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-1 md:mb-2",children:"Processing Times"}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-600 dark:text-gray-400",children:["Bank transfers take ",P("bankTransfer")," to reflect."]})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-neutral-700/50 rounded-lg",children:[e.jsx("h4",{className:"text-xs md:text-sm font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-1 md:mb-2",children:"24/7 Support"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-600 dark:text-gray-400",children:"Contact support for any issues: support@example.com"})]})]})]})]})]})]})})}export{Ke as default};
