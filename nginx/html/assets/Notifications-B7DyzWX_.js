import{r as l,a as W,u as Y,a$ as u,j as t,l as G,at as P,B as N,b0 as F,az as H,X as S,c as J,b1 as O,U as X,aM as K,C as Q,T as Z}from"./index-Dd7dhgAO.js";import{F as ee}from"./funnel-DMih0nG-.js";import{R as M}from"./refresh-cw-DojXSWB7.js";import{T as R}from"./triangle-alert-B17QfviJ.js";import{D as q}from"./dollar-sign-C7Q1cJTe.js";import{G as te}from"./gamepad-2-DzKUdUBx.js";function ce(){const[i,h]=l.useState([]),[D,j]=l.useState(!0),[v,c]=l.useState(""),[_,p]=l.useState(""),[n,y]=l.useState(0),[r,f]=l.useState("all"),[T,g]=l.useState(!1),d=W(),{user:ae}=Y(),o=l.useCallback(async()=>{try{j(!0),c("");const e=await u.getAll();h(e.notifications||[])}catch(e){console.error("Failed to load notifications:",e),c(e.response?.data?.message||"Failed to load notifications")}finally{j(!1)}},[]),C=l.useCallback(async()=>{try{const e=await u.getUnreadCount();y(e.count||0)}catch(e){console.error("Failed to load unread count:",e)}},[]);l.useEffect(()=>{o(),C()},[o,C]);const $=async e=>{try{await u.markAsRead(e),h(i.map(a=>a.id===e?{...a,is_read:!0}:a)),y(a=>Math.max(0,a-1))}catch(a){console.error("Failed to mark notification as read:",a),c("Failed to mark notification as read")}},b=async()=>{try{await u.markAllAsRead(),h(i.map(e=>({...e,is_read:!0}))),y(0),p("All notifications marked as read"),setTimeout(()=>p(""),3e3)}catch(e){console.error("Failed to mark all notifications as read:",e),c("Failed to mark all notifications as read")}},V=async(e,a)=>{a.stopPropagation();try{await u.deleteNotification(e),h(i.filter(s=>s.id!==e));const x=i.find(s=>s.id===e);x&&!x.is_read&&y(s=>Math.max(0,s-1))}catch(x){console.error("Failed to delete notification:",x),c("Failed to delete notification")}},U=async e=>{if(e.is_read||await $(e.id),e.related_entity_type&&e.related_entity_id)switch(e.related_entity_type){case"match":d(`/matches/${e.related_entity_id}`);break;case"tournament":d(`/tournaments/${e.related_entity_id}`);break;case"dispute":d(`/disputes/${e.related_entity_id}`);break;case"friend_request":d("/friends/requests");break;case"wallet":d("/wallet");break;default:console.log("Unknown entity type:",e.related_entity_type)}else switch(e.type){case"friend_request":d("/friends/requests");break;case"wallet_update":d("/wallet");break;default:console.log("No specific action for this notification")}},z=e=>{switch(e){case"match":return t.jsx(te,{className:"h-5 w-5"});case"tournament":return t.jsx(Z,{className:"h-5 w-5"});case"match_reminder":return t.jsx(Q,{className:"h-5 w-5"});case"prize":return t.jsx(q,{className:"h-5 w-5"});case"dispute":return t.jsx(R,{className:"h-5 w-5"});case"tournament_invite":return t.jsx(K,{className:"h-5 w-5"});case"friend_request":return t.jsx(X,{className:"h-5 w-5"});case"wallet_update":return t.jsx(q,{className:"h-5 w-5"});case"system":return t.jsx(O,{className:"h-5 w-5"});default:return t.jsx(F,{className:"h-5 w-5"})}},I=e=>{switch(e){case"match":return"text-blue-500 bg-blue-500/10";case"tournament":return"text-yellow-500 bg-yellow-500/10";case"prize":return"text-emerald-500 bg-emerald-500/10";case"dispute":return"text-red-500 bg-red-500/10";case"friend_request":return"text-purple-500 bg-purple-500/10";case"wallet_update":return"text-green-500 bg-green-500/10";default:return"text-gray-500 bg-gray-500/10"}},L=e=>{if(e.related_entity_type)switch(e.related_entity_type){case"match":return"View Match";case"tournament":return"View Tournament";case"dispute":return"View Dispute";case"friend_request":return"View Requests";case"wallet":return"View Wallet";default:return"View Details"}switch(e.type){case"friend_request":return"View Requests";case"wallet_update":return"View Wallet";default:return"View Details"}},B=e=>{const a=new Date(e),s=Math.floor((new Date-a)/(1e3*60)),w=Math.floor(s/60),A=Math.floor(w/24);return s<1?"Just now":s<60?`${s}m ago`:w<24?`${w}h ago`:A<7?`${A}d ago`:a.toLocaleDateString("en-US",{month:"short",day:"numeric"})},m=i.filter(e=>r==="all"?!0:r==="unread"?!e.is_read:r==="read"?e.is_read:r==="tournament"?e.type==="tournament"||e.type==="tournament_invite":r==="wallet"?e.type==="wallet_update"||e.type==="prize":!0),k=[{id:"all",label:"All",count:i.length},{id:"unread",label:"Unread",count:n},{id:"tournament",label:"Tournaments",count:i.filter(e=>e.type==="tournament"||e.type==="tournament_invite").length},{id:"wallet",label:"Wallet",count:i.filter(e=>e.type==="wallet_update"||e.type==="prize").length}],E=()=>t.jsxs("div",{className:`fixed inset-0 z-50 md:hidden transition-transform duration-300 ${T?"translate-x-0":"translate-x-full"}`,children:[t.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>g(!1)}),t.jsxs("div",{className:"fixed right-0 top-0 bottom-0 w-64 bg-white dark:bg-neutral-800 shadow-xl",children:[t.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-neutral-700 flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-900 dark:text-white",children:"Filter Notifications"}),t.jsx("button",{onClick:()=>g(!1),className:"p-2",children:t.jsx(S,{className:"h-5 w-5 text-gray-500"})})]}),t.jsx("div",{className:"p-4 space-y-2",children:k.map(e=>t.jsxs("button",{onClick:()=>{f(e.id),g(!1)},className:`w-full flex items-center justify-between p-3 rounded-lg transition-colors ${r===e.id?"bg-primary-50 dark:bg-primary-900/20 text-primary-600 dark:text-primary-400":"hover:bg-gray-50 dark:hover:bg-neutral-700"}`,children:[t.jsx("span",{className:"font-medium",children:e.label}),t.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${r===e.id?"bg-primary-100 dark:bg-primary-800 text-primary-600 dark:text-primary-300":"bg-gray-100 dark:bg-neutral-700 text-gray-600 dark:text-gray-400"}`,children:e.count})]},e.id))})]})]});return D?t.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-neutral-900",children:t.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:t.jsx(G,{size:"lg",text:"Loading notifications..."})})}):t.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-neutral-900 safe-padding",children:[t.jsx(E,{}),t.jsxs("main",{className:"mx-auto max-w-4xl py-4 md:py-8 px-3 sm:px-4 lg:px-8",children:[t.jsxs("div",{className:"lg:hidden mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-900 dark:text-white",children:"Notifications"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-0.5",children:n>0?`${n} unread`:"All caught up"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>g(!0),className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:t.jsx(ee,{className:"h-5 w-5"})}),n>0&&t.jsx("button",{onClick:b,className:"text-primary-600 dark:text-primary-500 hover:text-primary-700 dark:hover:text-primary-400 text-sm font-medium",children:"Mark All Read"})]})]}),t.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 no-scrollbar",children:k.map(e=>t.jsxs("button",{onClick:()=>f(e.id),className:`px-3 py-1.5 rounded-full text-sm whitespace-nowrap transition-colors ${r===e.id?"bg-primary-500 text-gray-900 dark:text-white":"bg-gray-100 dark:bg-neutral-800 text-gray-700 dark:text-gray-300"}`,children:[e.label,e.count>0&&t.jsx("span",{className:`ml-1 px-1.5 py-0.5 rounded-full text-xs ${r===e.id?"bg-white/20":"bg-gray-200 dark:bg-neutral-700"}`,children:e.count})]},e.id))})]}),t.jsxs("div",{className:"hidden lg:flex justify-between items-center mb-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-900 dark:text-white",children:"Notifications"}),t.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Stay updated with your tournament activities"})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[n>0&&t.jsxs("button",{onClick:b,className:"inline-flex items-center text-primary-600 dark:text-primary-500 hover:text-primary-700 dark:hover:text-primary-400 text-sm font-medium transition-colors",children:[t.jsx(P,{className:"h-4 w-4 mr-1"}),"Mark all as read"]}),t.jsxs("button",{onClick:o,className:"inline-flex items-center text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-300 text-sm font-medium transition-colors",children:[t.jsx(M,{className:"h-4 w-4 mr-1"}),"Refresh"]})]})]}),v&&t.jsx(N,{type:"error",title:"Action Failed",message:v,onClose:()=>c(""),className:"mb-4"}),_&&t.jsx(N,{type:"success",title:"Success!",message:_,onClose:()=>p(""),className:"mb-4"}),n>0&&t.jsx(N,{type:"info",title:`You have ${n} unread notification${n>1?"s":""}`,message:"Click on notifications to mark them as read and take action.",action:{text:"Mark All as Read",onClick:b},className:"mb-6"}),t.jsx("div",{className:"hidden lg:flex space-x-1 mb-6",children:k.map(e=>t.jsxs("button",{onClick:()=>f(e.id),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${r===e.id?"bg-primary-500 text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-neutral-800"}`,children:[e.label,e.count>0&&t.jsx("span",{className:`ml-2 px-1.5 py-0.5 rounded-full text-xs ${r===e.id?"bg-white/20":"bg-gray-200 dark:bg-neutral-700"}`,children:e.count})]},e.id))}),m.length===0&&t.jsxs("div",{className:"text-center py-12 bg-white dark:bg-neutral-800 rounded-xl border border-gray-200 dark:border-neutral-700",children:[t.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-gray-100 dark:bg-neutral-700 flex items-center justify-center mb-4",children:t.jsx(F,{className:"h-8 w-8 text-gray-400 dark:text-gray-500"})}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-900 dark:text-white mb-2",children:r!=="all"?`No ${r} notifications`:"All caught up!"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 max-w-md mx-auto px-4",children:r!=="all"?`You don't have any ${r} notifications at the moment.`:"You don't have any notifications at the moment. Check back later for updates."}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[t.jsx("button",{onClick:()=>d("/tournaments"),className:"bg-primary-500 hover:bg-primary-600 text-gray-900 dark:text-white font-medium py-2 px-4 rounded-lg transition-colors text-sm",children:"Browse Tournaments"}),t.jsx("button",{onClick:o,className:"bg-gray-100 dark:bg-neutral-700 hover:bg-gray-200 dark:hover:bg-neutral-600 text-gray-900 dark:text-gray-900 dark:text-white font-medium py-2 px-4 rounded-lg transition-colors text-sm",children:"Refresh"})]})]}),m.length>0&&t.jsx("div",{className:"space-y-3",children:m.map(e=>t.jsx("div",{className:`group p-4 rounded-xl border cursor-pointer transition-all duration-200 ${e.is_read?"bg-white dark:bg-neutral-800 border-gray-200 dark:border-neutral-700 hover:border-gray-300 dark:hover:border-neutral-600":"bg-primary-50 dark:bg-primary-900/10 border-primary-200 dark:border-primary-500/30 hover:border-primary-300 dark:hover:border-primary-500/50"}`,onClick:()=>U(e),children:t.jsxs("div",{className:"flex items-start",children:[t.jsx("div",{className:`p-2 rounded-lg ${I(e.type)} mr-3 flex-shrink-0`,children:z(e.type)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex justify-between items-start mb-1",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("h3",{className:`font-medium text-sm md:text-base ${e.is_read?"text-gray-900 dark:text-gray-900 dark:text-white":"text-primary-800 dark:text-primary-300"}`,children:e.title}),!e.is_read&&t.jsx("span",{className:"h-2 w-2 rounded-full bg-primary-500 dark:bg-primary-400 flex-shrink-0"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:a=>{a.stopPropagation(),e.is_read||$(e.id)},className:`p-1 rounded ${e.is_read?"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300":"text-primary-500 hover:text-primary-700 dark:hover:text-primary-400"}`,title:e.is_read?"Mark as unread":"Mark as read",children:t.jsx(H,{className:"h-4 w-4"})}),t.jsx("button",{onClick:a=>V(e.id,a),className:"p-1 text-gray-400 hover:text-red-500 rounded opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete notification",children:t.jsx(S,{className:"h-4 w-4"})})]})]}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-2 line-clamp-2",children:e.message}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("p",{className:"text-gray-500 dark:text-gray-500 text-xs",children:B(e.created_at)}),t.jsxs("span",{className:"inline-flex items-center text-primary-600 dark:text-primary-500 hover:text-primary-700 dark:hover:text-primary-400 text-sm font-medium transition-colors",children:[L(e),t.jsx(J,{className:"h-4 w-4 ml-1"})]})]})]})]})},e.id))}),m.length>0&&i.length>10&&t.jsx("div",{className:"mt-6 text-center",children:t.jsxs("button",{onClick:o,className:"inline-flex items-center bg-gray-100 dark:bg-neutral-800 hover:bg-gray-200 dark:hover:bg-neutral-700 text-gray-700 dark:text-gray-300 font-medium py-2 px-4 rounded-lg transition-colors",children:[t.jsx(M,{className:"h-4 w-4 mr-2"}),"Load More"]})}),m.length>0&&t.jsx("div",{className:"mt-6 bg-gray-50 dark:bg-neutral-800 rounded-lg p-4 border border-gray-200 dark:border-neutral-700",children:t.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[t.jsx(R,{className:"h-4 w-4 mr-2 text-yellow-500 flex-shrink-0"}),t.jsx("p",{children:"Notifications are automatically cleared after 30 days. Important system notifications will always be available."})]})}),t.jsx("div",{className:"h-16 md:h-0"})]})]})}export{ce as default};
